<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Celulares - TICS Aeropuerto</title>
    <link rel="stylesheet" href="../assets/css/airport-theme.css">
</head>
<body>
<div class="airport-layout">

    <header class="terminal-header">
        <div class="logo-section"><span style="font-size:1.6rem;">üì±</span><h1>Celulares</h1></div>
        <div class="header-actions">
            <span id="userInfo" style="font-size:var(--text-sm);color:var(--gray-600);"></span>
            <button class="btn btn-secondary btn-sm" onclick="logout()">üö™ Salir</button>
        </div>
    </header>

    <aside class="gate-sidebar">
        <div class="sidebar-section">
            <p class="section-title">Panel</p>
            <ul class="nav-menu"><li class="nav-item"><a href="dashboard.html" class="nav-link">üìä Dashboard</a></li></ul>
        </div>
        <div class="sidebar-section">
            <p class="section-title">Equipos</p>
            <ul class="nav-menu">
                <li class="nav-item"><a href="computador.html"  class="nav-link">üíª Computadores</a></li>
                <li class="nav-item"><a href="celular.html"     class="nav-link active">üì± Celulares</a></li>
                <li class="nav-item"><a href="impresora.html"   class="nav-link">üñ®Ô∏è Impresoras</a></li>
                <li class="nav-item"><a href="radio.html"       class="nav-link">üìª Radios</a></li>
                <li class="nav-item"><a href="telefono_ip.html" class="nav-link">üìû Tel√©fonos IP</a></li>
                <li class="nav-item"><a href="tablet.html"      class="nav-link">üì≤ Tablets</a></li>
                <li class="nav-item"><a href="accesorios.html"  class="nav-link">üîå Accesorios</a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <p class="section-title">Gesti√≥n</p>
            <ul class="nav-menu">
                <li class="nav-item"><a href="persona.html"   class="nav-link">üë• Personas</a></li>
                <li class="nav-item"><a href="ubicacion.html" class="nav-link">üìç Ubicaciones</a></li>
            </ul>
        </div>
    </aside>

    <main class="boarding-area">
        <div class="flight-board">
            <div class="flight-board-header">
                <h2>üì± Lista de Celulares</h2>
                <div style="display:flex;gap:var(--spacing-sm);">
                    <input type="text" id="searchInput" placeholder="Buscar celular..." class="form-input" style="max-width:240px;">
                    <select id="estadoFilter" class="form-input" style="max-width:160px;">
                        <option value="">Todos</option>
                        <option value="Activo">Activo</option>
                        <option value="Mantenimiento">Mantenimiento</option>
                        <option value="Almac√©n">Almac√©n</option>
                        <option value="Dado de baja">Dado de baja</option>
                    </select>
                    <button class="btn btn-primary" onclick="openModal()">+ Nuevo</button>
                </div>
            </div>
            <div class="table-wrapper">
                <table class="table">
                    <thead><tr>
                        <th>N√∫mero</th><th>Nombre</th><th>Marca/Modelo</th>
                        <th>Operador</th><th>Usuario</th><th>Estado</th><th>Est. F√≠sico</th><th>Acciones</th>
                    </tr></thead>
                    <tbody id="tableBody"><tr><td colspan="8" class="td-empty">Cargando...</td></tr></tbody>
                </table>
            </div>
        </div>
    </main>
</div>

<!-- MODAL -->
<div id="modal" class="modal" style="display:none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Nuevo Celular</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="form">
                    <input type="hidden" id="id_celular">
                    <div class="fgrid2">
                        <div class="form-group"><label class="form-label">N√∫mero celular *</label><input type="text" id="numero_celular" class="form-input" required placeholder="Ej: 3001234567"></div>
                        <div class="form-group"><label class="form-label">Nombre</label><input type="text" id="nombre_celular" class="form-input" placeholder="Nombre del equipo"></div>
                    </div>
                    <div class="fgrid3">
                        <div class="form-group"><label class="form-label">Marca</label><input type="text" id="marca" class="form-input"></div>
                        <div class="form-group"><label class="form-label">Modelo</label><input type="text" id="modelo" class="form-input"></div>
                        <div class="form-group"><label class="form-label">Serial</label><input type="text" id="serial_celular" class="form-input"></div>
                    </div>
                    <div class="fgrid3">
                        <div class="form-group"><label class="form-label">Operador</label>
                            <select id="sim_company" class="form-input">
                                <option value="CLARO">CLARO</option><option value="TIGO">TIGO</option>
                                <option value="MOVISTAR">MOVISTAR</option><option value="WOM">WOM</option>
                                <option value="ETB">ETB</option><option value="Virgin Mobile">Virgin Mobile</option>
                                <option value="No definido">No definido</option>
                            </select>
                        </div>
                        <div class="form-group"><label class="form-label">IMEI 1</label><input type="text" id="imei1_celular" class="form-input"></div>
                        <div class="form-group"><label class="form-label">IMEI 2</label><input type="text" id="imei2_celular" class="form-input"></div>
                    </div>
                    <div class="fgrid3">
                        <div class="form-group"><label class="form-label">Sistema Op.</label>
                            <select id="sistema_op" class="form-input">
                                <option value="ANDROID">ANDROID</option>
                                <option value="IOS">IOS</option>
                                <option value="OTRO">OTRO</option>
                            </select>
                        </div>
                        <div class="form-group"><label class="form-label">Plan de datos</label><input type="text" id="plan_datos" class="form-input"></div>
                        <div class="form-group"><label class="form-label">Fecha adquisici√≥n</label><input type="date" id="fecha_adquisicion" class="form-input"></div>
                    </div>
                    <div class="fgrid2">
                        <div class="form-group"><label class="form-label">Estado operativo</label>
                            <select id="estado" class="form-input">
                                <option value="Activo">Activo</option>
                                <option value="Mantenimiento">Mantenimiento</option>
                                <option value="Almac√©n">Almac√©n</option>
                                <option value="Dado de baja">Dado de baja</option>
                            </select>
                        </div>
                        <div class="form-group"><label class="form-label">Estado f√≠sico</label>
                            <select id="estado_fisico" class="form-input">
                                <option value="Bueno">Bueno</option>
                                <option value="Nuevo">Nuevo</option>
                                <option value="Da√±ado">Da√±ado</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group"><label class="form-label">Notas</label><textarea id="notas" class="form-input" rows="2" style="resize:vertical;"></textarea></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="save()">üíæ Guardar</button>
            </div>
        </div>
    </div>
</div>

<script src="../assets/js/api.js"></script>
<script src="../assets/js/components.js"></script>
<script>
    let data=[]; let userRol=null;
    const FB={Nuevo:'badge-info',Bueno:'badge-success','Da√±ado':'badge-danger'};
    const EB={Activo:'badge-success',Mantenimiento:'badge-warning','Dado de baja':'badge-danger','Almac√©n':'badge-secondary'};

    async function loadData(){
        try{
            const ur=await API.getMe(); if(ur.success){document.getElementById('userInfo').textContent=ur.data.nombre;userRol=ur.data.rol;}
            const s=document.getElementById('searchInput').value, e=document.getElementById('estadoFilter').value;
            const r=await API.getCelulares({search:s,estado:e});
            if(r.success){data=r.data;renderTable();}
        }catch(e){showError('Error: '+e.message);}
    }

    function renderTable(){
        const tb=document.getElementById('tableBody');
        if(!data.length){tb.innerHTML='<tr><td colspan="8" class="td-empty">No hay celulares</td></tr>';return;}
        const canEdit=userRol==='admin'||userRol==='technician';
        tb.innerHTML=data.map(c=>`<tr>
            <td><strong>${c.numero_celular||'-'}</strong></td>
            <td>${c.nombre_celular||'-'}</td>
            <td>${c.marca||'-'}${c.modelo?' / '+c.modelo:''}</td>
            <td>${c.sim_company||'-'}</td>
            <td>${c.nombre_usuario||'<em style="color:var(--gray-400)">Sin asignar</em>'}</td>
            <td><span class="badge ${EB[c.estado]||'badge-secondary'}">${c.estado||'-'}</span></td>
            <td><span class="badge ${FB[c.estado_fisico]||'badge-secondary'}">${c.estado_fisico||'-'}</span></td>
            <td>
                ${canEdit?`<button class="btn btn-sm btn-primary" onclick='edit(${JSON.stringify(c)})'>‚úèÔ∏è</button>`:''}
                ${userRol==='admin'?`<button class="btn btn-sm btn-danger" onclick="del(${c.id_celular})">üóëÔ∏è</button>`:''}
            </td>
        </tr>`).join('');
    }

    function openModal(isEdit=false){
        document.getElementById('modalTitle').textContent=isEdit?'Editar Celular':'Nuevo Celular';
        if(!isEdit){document.getElementById('form').reset();document.getElementById('id_celular').value='';}
        document.getElementById('modal').style.display='flex';
    }
    function closeModal(){document.getElementById('modal').style.display='none';}

    function edit(c){
        openModal(true);
        const fields=['id_celular','numero_celular','nombre_celular','marca','modelo','serial_celular',
                       'sim_company','imei1_celular','imei2_celular','sistema_op','plan_datos','estado','estado_fisico','notas'];
        fields.forEach(f=>{const el=document.getElementById(f);if(el)el.value=c[f]??'';});
        if(c.fecha_adquisicion)document.getElementById('fecha_adquisicion').value=c.fecha_adquisicion.split('T')[0];
    }

    async function del(id){
        if(!confirmAction('¬øDar de baja este celular?'))return;
        try{const r=await API.deleteCelular(id);if(r.success){showSuccess('Dado de baja');loadData();}}
        catch(e){showError('Error: '+e.message);}
    }

    async function save(){
        const num=document.getElementById('numero_celular').value.trim();
        if(!num){showError('El n√∫mero es requerido');return;}
        const id=document.getElementById('id_celular').value;
        const datos={
            numero_celular:num,
            nombre_celular:document.getElementById('nombre_celular').value.trim()||null,
            marca:document.getElementById('marca').value.trim()||null,
            modelo:document.getElementById('modelo').value.trim()||null,
            serial_celular:document.getElementById('serial_celular').value.trim()||null,
            sim_company:document.getElementById('sim_company').value,
            imei1_celular:document.getElementById('imei1_celular').value.trim()||null,
            imei2_celular:document.getElementById('imei2_celular').value.trim()||null,
            sistema_op:document.getElementById('sistema_op').value,
            plan_datos:document.getElementById('plan_datos').value.trim()||null,
            estado:document.getElementById('estado').value,
            estado_fisico:document.getElementById('estado_fisico').value,
            fecha_adquisicion:document.getElementById('fecha_adquisicion').value||null,
            notas:document.getElementById('notas').value.trim()||null
        };
        try{
            const r=id?await API.updateCelular(id,datos):await API.createCelular(datos);
            if(r.success){showSuccess(id?'Actualizado':'Creado');closeModal();loadData();}
        }catch(e){showError('Error: '+e.message);}
    }

    document.getElementById('searchInput').addEventListener('input',loadData);
    document.getElementById('estadoFilter').addEventListener('change',loadData);
    loadData();
</script>
<style>
    .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:var(--z-modal);}
    .modal-dialog{background:white;border-radius:var(--radius-lg);max-width:700px;width:90%;max-height:90vh;overflow-y:auto;box-shadow:var(--shadow-2xl);}
    .modal-dialog::before{content:'';display:block;height:4px;background:linear-gradient(90deg,var(--airport-primary),var(--airport-accent));border-radius:var(--radius-lg) var(--radius-lg) 0 0;}
    .modal-header{padding:var(--spacing-lg) var(--spacing-xl);border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center;}
    .modal-header h3{font-size:var(--text-lg);font-weight:700;}
    .modal-close{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--gray-400);width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-md);}
    .modal-close:hover{background:var(--gray-100);}
    .modal-body{padding:var(--spacing-xl);} .modal-footer{padding:var(--spacing-lg) var(--spacing-xl);border-top:1px solid var(--border-color);display:flex;justify-content:flex-end;gap:var(--spacing-md);}
    .fgrid2{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-md);}
    .fgrid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:var(--spacing-md);}
    .badge{padding:4px 10px;border-radius:12px;font-size:var(--text-xs);font-weight:600;}
    .badge-success{background:#d4edda;color:#155724;}.badge-info{background:#d1ecf1;color:#0c5460;}
    .badge-warning{background:#fff3cd;color:#856404;}.badge-danger{background:#f8d7da;color:#721c24;}
    .badge-secondary{background:#e2e3e5;color:#383d41;}
    .btn-sm{padding:5px 10px;font-size:var(--text-xs);border:none;border-radius:var(--radius-sm);cursor:pointer;font-weight:600;}
    .btn-danger{background:var(--status-retired);color:white;}
    .td-empty{text-align:center;padding:2rem;color:var(--gray-400);}
    @media(max-width:640px){.fgrid2,.fgrid3{grid-template-columns:1fr;}}
</style>
</body>
</html>