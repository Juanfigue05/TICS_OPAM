<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesi√≥n - TICS Aeropuerto</title>
    <link rel="stylesheet" href="./assets/css/airport-theme.css">
</head>
<body class="login-page">

    <div class="login-container">
        <div class="login-card">

            <!-- ENCABEZADO -->
            <div class="login-header">
                <div class="login-logo">
                    <span class="login-logo-icon">‚úàÔ∏è</span>
                </div>
                <h1 class="login-title">TICS Aeropuerto</h1>
                <p class="login-subtitle">Sistema de Gesti√≥n de Inventario TI</p>
                <p class="login-org">Aeropuerto Alfonso Bonilla Arag√≥n ‚Äî OPAM</p>
            </div>

            <!-- FORMULARIO -->
            <form id="loginForm" class="login-form" autocomplete="off">

                <div class="form-group">
                    <label class="form-label" for="username">Usuario</label>
                    <div class="input-icon-wrap">
                        <span class="input-icon">üë§</span>
                        <input
                            type="text"
                            id="username"
                            name="username"
                            class="form-input input-with-icon"
                            placeholder="Ingresa tu usuario"
                            required
                            autofocus
                            autocomplete="username"
                        >
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">Contrase√±a</label>
                    <div class="input-icon-wrap">
                        <span class="input-icon">üîí</span>
                        <input
                            type="password"
                            id="password"
                            name="password"
                            class="form-input input-with-icon"
                            placeholder="Ingresa tu contrase√±a"
                            required
                            autocomplete="current-password"
                        >
                        <button type="button" class="input-toggle-password" id="togglePwd" title="Mostrar/ocultar contrase√±a">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>

                <!-- MENSAJE DE ERROR -->
                <div id="errorMessage" class="login-error" style="display:none;"></div>

                <!-- BOT√ìN DE ACCESO -->
                <button type="submit" class="btn btn-primary btn-block" id="submitBtn">
                    Iniciar Sesi√≥n
                </button>

            </form>

            <!-- PIE -->
            <div class="login-footer">
                <p>OPAM ¬∑ Aeropuerto Alfonso Bonilla Arag√≥n</p>
                <p class="text-muted">v2.0.0 ¬∑ Sistema TICS</p>
            </div>

        </div>
    </div>

    <script>
    // ‚îÄ‚îÄ‚îÄ Cliente API m√≠nimo para login (sin protecci√≥n de ruta) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    (function() {

        // Si ya hay token v√°lido, redirigir al dashboard
        if (localStorage.getItem('token')) {
            window.location.href = './pages/dashboard.html';
            return;
        }

        // Toggle mostrar/ocultar contrase√±a
        document.getElementById('togglePwd').addEventListener('click', function() {
            const pwd = document.getElementById('password');
            pwd.type = pwd.type === 'password' ? 'text' : 'password';
        });

        // Submit del formulario
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const username   = document.getElementById('username').value.trim();
            const password   = document.getElementById('password').value;
            const errorDiv   = document.getElementById('errorMessage');
            const submitBtn  = document.getElementById('submitBtn');

            if (!username || !password) {
                errorDiv.textContent = 'Por favor ingresa usuario y contrase√±a.';
                errorDiv.style.display = 'block';
                return;
            }

            submitBtn.disabled    = true;
            submitBtn.textContent = 'Verificando...';
            errorDiv.style.display = 'none';

            try {
                const response = await fetch(`${window.location.origin}/api/auth/login`, {
                    method:  'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body:    JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.success) {
                    // Guardar token y datos de usuario
                    localStorage.setItem('token',   data.token);
                    localStorage.setItem('usuario', JSON.stringify(data.usuario));
                    // Redirigir al dashboard
                    window.location.href = './pages/dashboard.html';
                } else {
                    throw new Error(data.error || 'Credenciales incorrectas');
                }

            } catch (error) {
                errorDiv.textContent   = error.message || 'Error de conexi√≥n con el servidor';
                errorDiv.style.display = 'block';
            } finally {
                submitBtn.disabled    = false;
                submitBtn.textContent = 'Iniciar Sesi√≥n';
            }
        });

    })();
    </script>

</body>
</html>